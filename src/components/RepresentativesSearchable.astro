---
interface Representative {
  name: string;
  phone: string;
  email: string;
  coveredRegions: string[];
}

interface Props {
  representatives: Representative[];
}

const { representatives } = Astro.props;
---

<div
  class="representatives-searchable"
  data-representatives={JSON.stringify(representatives)}
>
  <div class="mb-8">
    <div class="relative">
      <svg
        class="absolute top-1/2 left-4 h-5 w-5 -translate-y-1/2 text-neutral-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input
        type="text"
        id="search-input"
        placeholder="Căutați după nume sau județ..."
        class="focus:border-primary focus:ring-primary focus:ring-opacity-20 w-full rounded-lg border-2 border-neutral-300 bg-white py-3.5 pr-4 pl-12 text-base transition-all focus:ring-2 focus:outline-none"
        aria-label="Căutare reprezentanți zonali"
      />
    </div>
  </div>

  <div id="results-container" class="grid gap-4 md:grid-cols-2">
    {
      representatives.map((rep) => (
        <article
          class="representative-card group hover:border-primary relative overflow-hidden rounded-xl border border-neutral-200 p-6 shadow-sm transition-all duration-300 hover:shadow-lg sm:p-8"
          data-name={rep.name.toLowerCase()}
          data-covered={rep.coveredRegions
            .map((r) => r.toLowerCase())
            .join(" ")}
        >
          <div class="mb-5 flex items-start justify-between">
            <div class="flex-1">
              <h3 class="group-hover:text-primary text-2xl font-bold text-neutral-900 transition-colors">
                {rep.name}
              </h3>
            </div>
            <div class="bg-primary/10 text-primary group-hover:bg-primary ml-4 flex h-12 w-12 items-center justify-center rounded-full transition-colors group-hover:text-white">
              <svg
                class="h-6 w-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
            </div>
          </div>

          <div class="space-y-4 text-neutral-700">
            <div class="group-hover:bg-primary/5 flex items-center gap-3 rounded-lg bg-neutral-50 p-3 transition-colors">
              <div class="bg-primary/10 flex h-10 w-10 shrink-0 items-center justify-center rounded-lg">
                <svg
                  class="h-5 w-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                  />
                </svg>
              </div>
              <div class="min-w-0 flex-1">
                <p class="text-xs font-semibold tracking-wide text-neutral-500 uppercase">
                  Telefon
                </p>
                <a
                  href={`tel:${rep.phone.replace(/[-\s.]/g, "")}`}
                  class="text-primary hover:text-primary/80 block truncate font-medium transition-colors"
                  aria-label={`Telefon: ${rep.phone}`}
                >
                  {rep.phone}
                </a>
              </div>
            </div>

            <div class="group-hover:bg-primary/5 flex items-center gap-3 rounded-lg bg-neutral-50 p-3 transition-colors">
              <div class="bg-primary/10 flex h-10 w-10 shrink-0 items-center justify-center rounded-lg">
                <svg
                  class="h-5 w-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
              </div>
              <div class="min-w-0 flex-1">
                <p class="text-xs font-semibold tracking-wide text-neutral-500 uppercase">
                  Email
                </p>
                <a
                  href={`mailto:${rep.email}`}
                  class="text-primary hover:text-primary/80 block truncate font-medium transition-colors"
                  aria-label={`Email: ${rep.email}`}
                >
                  {rep.email}
                </a>
              </div>
            </div>

            <div class="mt-5 rounded-lg border border-neutral-200 bg-white p-4">
              <p class="mb-2 text-xs font-semibold tracking-wide text-neutral-500 uppercase">
                Zone acoperite
              </p>
              <div class="flex flex-wrap gap-2">
                {rep.coveredRegions.map((region) => (
                  <span class="bg-primary/10 rounded-full px-3 py-1 text-xs font-medium">
                    {region}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </article>
      ))
    }
  </div>

  <div
    id="no-results"
    class="hidden rounded-xl border-2 border-dashed border-neutral-300 bg-neutral-50 p-12 text-center"
  >
    <div
      class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-neutral-200"
    >
      <svg
        class="h-8 w-8 text-neutral-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        ></path>
      </svg>
    </div>
    <p class="text-lg font-semibold text-neutral-700">
      Nu s-au găsit reprezentanți pentru căutarea dvs.
    </p>
    <p class="mt-2 text-sm text-neutral-500">
      Încercați să căutați după alt termen.
    </p>
  </div>
</div>

<script>
  const container = document.querySelector(".representatives-searchable");
  if (container) {
    const searchInput = container.querySelector(
      "#search-input",
    ) as HTMLInputElement;
    const resultsContainer = container.querySelector(
      "#results-container",
    ) as HTMLElement;
    const noResults = container.querySelector("#no-results") as HTMLElement;
    const cards = container.querySelectorAll(
      ".representative-card",
    ) as NodeListOf<HTMLElement>;

    function filterResults() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      let visibleCount = 0;

      cards.forEach((card) => {
        const name = card.dataset.name || "";
        const covered = card.dataset.covered || "";

        const matches =
          name.includes(searchTerm) || covered.includes(searchTerm);

        if (matches || searchTerm === "") {
          card.style.display = "";
          visibleCount++;
        } else {
          card.style.display = "none";
        }
      });

      if (visibleCount === 0 && searchTerm !== "") {
        resultsContainer.style.display = "none";
        noResults.classList.remove("hidden");
      } else {
        resultsContainer.style.display = "";
        noResults.classList.add("hidden");
      }
    }

    searchInput.addEventListener("input", filterResults);
  }
</script>
